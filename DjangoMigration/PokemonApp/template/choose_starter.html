{% extends "base.html" %}
{% load static %}
{% load custom_filters %}

{% block title %}<title>Choisissez votre Pok√©mon de d√©part !</title>{% endblock title %}

{% block content %}
<div class="container mt-4">
  <div class="row justify-content-center">
    <div class="col-lg-10">

      <!-- Header -->
      <div class="text-center mb-5">
        <img src="{% static 'img/pokedex_transparent.png' %}" style="width:60px;" alt="Pok√©dex" class="mb-3">
        <h1 class="h2 font-weight-bold text-gray-800">Bienvenue, {{ trainer.username }} !</h1>
        <p class="lead text-muted">
          Professeur Chen vous attend. Choisissez votre Pok√©mon de d√©part pour commencer votre aventure !
        </p>
        <hr>
      </div>

      <!-- Starters -->
      <form method="post">
        {% csrf_token %}
        <div class="row justify-content-center">

          {% for starter, is_shiny in starters_with_shiny %}
          <div class="col-md-4 mb-4">
            <div class="card h-100 starter-card shadow-sm {% if is_shiny %}starter-card-shiny{% endif %}"
                 data-starter-id="{{ starter.id }}"
                 style="cursor:pointer; transition: transform 0.15s, box-shadow 0.15s; border: 3px solid transparent;">
              
              <!-- Sprite centr√© -->
              <div class="card-body text-center pb-0">

                {% if is_shiny %}
                <div class="shiny-badge-wrapper">
                  <span class="shiny-badge">‚ú® Chromatique !</span>
                </div>
                {% endif %}

                <img src="{% static 'img/sprites_gen5/' %}{% if is_shiny %}shiny{% else %}normal{% endif %}/{{ starter.name|lowerPokemonFileNames }}.png"
                     alt="{{ starter.name }}{% if is_shiny %} (Chromatique){% endif %}"
                     style="width:120px;height:120px;object-fit:contain;"
                     onerror="this.src='{% static 'img/pokeball.png' %}'">
                
                <h4 class="mt-3 font-weight-bold">
                  {{ starter.name }}
                  {% if is_shiny %}<span title="Chromatique !">‚ú®</span>{% endif %}
                </h4>

                <!-- Types -->
                <div class="mb-2">
                  <span class="badge badge-type-{{ starter.primary_type.name }} mr-1">
                    {{ starter.primary_type.name|upper }}
                  </span>
                  {% if starter.secondary_type %}
                  <span class="badge badge-type-{{ starter.secondary_type.name }}">
                    {{ starter.secondary_type.name|upper }}
                  </span>
                  {% endif %}
                </div>

                <!-- Stats de base -->
                <small class="text-muted">
                  <div>‚ù§Ô∏è PV : {{ starter.base_hp }}</div>
                  <div>‚öîÔ∏è ATK : {{ starter.base_attack }}</div>
                  <div>üõ°Ô∏è DEF : {{ starter.base_defense }}</div>
                  <div>‚ö° VIT : {{ starter.base_speed }}</div>
                </small>
              </div>

              <div class="card-footer text-center bg-transparent border-0 pt-2 pb-3">
                <button type="submit" name="starter_id" value="{{ starter.id }}"
                        class="btn {% if is_shiny %}btn-warning{% else %}btn-outline-primary{% endif %} btn-choose-starter">
                  <i class="fas fa-hand-pointer"></i> Choisir {{ starter.name }}{% if is_shiny %} ‚ú®{% endif %}
                </button>
              </div>
            </div>
          </div>
          {% empty %}
          <div class="col-12 text-center text-danger">
            <p>Aucun Pok√©mon de d√©part n'est configur√© dans la base de donn√©es.<br>
               Demandez √† votre administrateur d'initialiser la base.</p>
          </div>
          {% endfor %}

        </div>
      </form>

    </div>
  </div>
</div>

<style>
.starter-card:hover {
  transform: translateY(-6px);
  box-shadow: 0 8px 24px rgba(0,0,0,0.15) !important;
}
.starter-card.selected {
  border-color: #4e73df !important;
  background: #f0f4ff;
}
.starter-card-shiny {
  border-color: #f6c23e !important;
  background: linear-gradient(135deg, #fffbe6 0%, #fff9c4 100%);
  box-shadow: 0 0 18px rgba(246, 194, 62, 0.5) !important;
  animation: shinyPulse 2s ease-in-out infinite;
}
@keyframes shinyPulse {
  0%, 100% { box-shadow: 0 0 18px rgba(246, 194, 62, 0.5) !important; }
  50%       { box-shadow: 0 0 32px rgba(246, 194, 62, 0.9) !important; }
}
.shiny-badge-wrapper {
  margin-bottom: 6px;
}
.shiny-badge {
  display: inline-block;
  background: linear-gradient(90deg, #f6c23e, #e0a800);
  color: #fff;
  font-weight: bold;
  font-size: 0.8rem;
  padding: 3px 10px;
  border-radius: 12px;
  letter-spacing: 0.5px;
  box-shadow: 0 2px 6px rgba(224,168,0,0.4);
}
.badge-type-Plante, .badge-type-grass { background:#78C850; color:#fff; }
.badge-type-Feu, .badge-type-fire { background:#F08030; color:#fff; }
.badge-type-Eau, .badge-type-water { background:#6890F0; color:#fff; }
.badge-type-Poison, .badge-type-poison { background:#A040A0; color:#fff; }
</style>

<script>
// Highlight au clic
document.querySelectorAll('.starter-card').forEach(card => {
  card.addEventListener('click', function() {
    document.querySelectorAll('.starter-card').forEach(c => c.classList.remove('selected'));
    this.classList.add('selected');
  });
});
</script>
{% endblock content %}