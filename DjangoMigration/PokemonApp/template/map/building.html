{% extends "base.html" %}
{% load static %}
{% load custom_filters %}

{% block title %}<title>{{ zone.name }}</title>{% endblock %}

{% block content %}
<div class="mb-3">
  <a href="{% url 'zone_detail' zone.id %}" class="btn btn-secondary btn-sm">
    <i class="fas fa-arrow-left"></i> Retour à {{ zone.name }}
  </a>
</div>

{# Bandeau #}
<div class="card shadow mb-4">
  <div class="card-header bg-dark text-white p-0 position-relative" style="overflow:hidden;min-height:140px;">
    <img src="{% static 'img/mapSprites/Kanto/' %}{{ zone.name|zone_image_path }}"
         alt="{{ zone.name }}" class="w-100"
         style="object-fit:cover;max-height:160px;opacity:.45;"
         onerror="this.style.display:'none'">
    <div class="position-absolute w-100 p-3" style="bottom:0;background:linear-gradient(transparent,rgba(0,0,0,.7));">
      <h2 class="mb-0 text-white">
        <i class="fas fa-building"></i> {{ zone.name }}
      </h2>
      <p class="text-white-50 mb-0">{{ floor_data|length }} étage{% if floor_data|length > 1 %}s{% endif %}</p>
    </div>
  </div>
</div>

{# Liste des étages (du haut vers le bas visuellement) #}
<div class="card shadow">
  <div class="card-header py-3">
    <h6 class="m-0 font-weight-bold text-primary">
      <i class="fas fa-layer-group"></i> Étages
    </h6>
  </div>
  <div class="card-body p-0">
    {% for fd in floor_data reversed %}
    <div class="floor-row d-flex align-items-center p-3 border-bottom {% if not fd.accessible %}floor-locked{% endif %}">

      {# Numéro d'étage #}
      <div class="floor-badge mr-3">{{ fd.floor.floor_name }}</div>

      {# Infos #}
      <div class="flex-grow-1">
        <strong>{{ fd.floor.floor_name }}</strong>
        {% if fd.floor.is_safe %}
        <span class="badge badge-success ml-1" style="font-size:.65rem;">Zone sûre</span>
        {% endif %}
        <p class="text-muted small mb-0">{{ fd.floor.description }}</p>
      </div>

      {# Accès #}
      {% if fd.accessible %}
        {% if is_current %}
        <a href="{% url 'floor_detail' zone.id fd.floor.floor_number %}"
           class="btn btn-primary btn-sm ml-3">
          <i class="fas fa-arrow-right"></i> Explorer
        </a>
        {% else %}
        <a href="{% url 'floor_detail' zone.id fd.floor.floor_number %}"
           class="btn btn-outline-primary btn-sm ml-3">
          <i class="fas fa-eye"></i> Voir
        </a>
        {% endif %}
      {% else %}
      <div class="ml-3 text-right">
        <span class="badge badge-danger d-block mb-1">
          <i class="fas fa-lock"></i> Bloqué
        </span>
        <small class="text-muted d-block" style="max-width:160px;font-size:.7rem;">{{ fd.reason }}</small>
      </div>
      {% endif %}
    </div>
    {% endfor %}
  </div>
</div>

<style>
.floor-row {
  transition: background .15s;
}
.floor-row:hover:not(.floor-locked) {
  background: #f8f9fc;
}
.floor-locked {
  opacity: .6;
}
.floor-badge {
  width: 48px;
  height: 48px;
  border-radius: 8px;
  background: linear-gradient(135deg, #4e73df, #2e59d9);
  color: #fff;
  font-weight: 800;
  font-size: .75rem;
  display: flex;
  align-items: center;
  justify-content: center;
  text-align: center;
  flex-shrink: 0;
  line-height: 1.1;
}
.floor-locked .floor-badge {
  background: linear-gradient(135deg, #aaa, #888);
}
</style>
{% endblock %}