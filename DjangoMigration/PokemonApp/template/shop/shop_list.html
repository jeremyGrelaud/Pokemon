{% extends "base.html" %}
{% load static %} {% load custom_filters %}

{% block title %}
<title>Boutiques - Pokémon Gen 1</title>
{% endblock title %}

{% block content %}
<!-- Page Heading -->
<div class="d-sm-flex align-items-center justify-content-between mb-4">
  <h1 class="h3 mb-0 text-gray-800">
    <i class="fas fa-shopping-cart text-primary"></i> Boutiques Pokémon
  </h1>
  <div>
    <span class="badge badge-warning p-2" style="font-size: 1.1rem;">
      <i class="fas fa-coins"></i> {{ trainer.money }}₽
    </span>
  </div>
</div>

<!-- Info Alert -->
<div class="alert alert-info mb-4">
  <i class="fas fa-info-circle"></i>
  <strong>Astuce :</strong> Visitez les boutiques pour acheter des Potions, Poké Balls et autres objets utiles !
  Certains objets ne sont disponibles qu'après avoir obtenu des badges.
</div>

<!-- Shops Grid -->
<div class="row">
  {% for shop in shops %}
  <div class="col-lg-4 col-md-6 mb-4">
    <div class="card shop-card h-100 shadow-sm border-0">
      <div class="card-header bg-gradient-primary text-white">
        <h5 class="mb-0">
          <i class="fas fa-store"></i> {{ shop.name }}
        </h5>
      </div>
      <div class="card-body">
        <!-- Shop Icon -->
        <div class="text-center mb-3">
          <i class="fas fa-shopping-bag fa-4x text-primary"></i>
        </div>

        <!-- Shop Info -->
        <div class="mb-3">
          <p class="mb-2">
            <strong><i class="fas fa-map-marker-alt text-danger"></i> Localisation :</strong><br>
            {{ shop.location }}
          </p>
          
          <p class="mb-2">
            <strong><i class="fas fa-tag text-success"></i> Type :</strong><br>
            <span class="badge badge-secondary p-2">{{ shop.get_shop_type_display }}</span>
          </p>

          {% if shop.description %}
          <p class="text-muted small mb-0">
            <i class="fas fa-quote-left"></i> {{ shop.description|truncatewords:15 }}
          </p>
          {% endif %}
        </div>

        <!-- Shop Stats -->
        <div class="row text-center mb-3">
          <div class="col-6">
            <div class="p-2 bg-light rounded">
              <h4 class="mb-0 text-primary">{{ shop.inventory.count }}</h4>
              <small class="text-muted">Articles</small>
            </div>
          </div>
          <div class="col-6">
            <div class="p-2 bg-light rounded">
              <h4 class="mb-0 text-success">
                {% with available=shop.inventory.filter|length %}
                {{ shop.inventory.count }}
                {% endwith %}
              </h4>
              <small class="text-muted">Disponibles</small>
            </div>
          </div>
        </div>

        <!-- Greeting -->
        {% if shop.shopkeeper_greeting %}
        <div class="alert alert-light border-left border-primary mb-3">
          <small class="text-muted font-italic">
            "{{ shop.shopkeeper_greeting }}"
          </small>
        </div>
        {% endif %}
      </div>
      
      <div class="card-footer bg-transparent border-0">
        <a href="{% url 'ShopDetailView' shop.id %}" class="btn btn-primary btn-block">
          <i class="fas fa-shopping-cart"></i> Visiter la Boutique
        </a>
      </div>
    </div>
  </div>
  {% empty %}
  <div class="col-12">
    <div class="card shadow">
      <div class="card-body text-center py-5">
        <i class="fas fa-store-slash fa-4x text-muted mb-3"></i>
        <h4 class="text-muted">Aucune boutique disponible</h4>
        <p class="text-muted">Les boutiques apparaîtront bientôt !</p>
      </div>
    </div>
  </div>
  {% endfor %}
</div>

<!-- Featured Shops Section (si vous voulez mettre en avant certaines boutiques) -->
{% if shops %}
<div class="row mt-4">
  <div class="col-12">
    <div class="card shadow border-warning">
      <div class="card-header bg-warning text-white">
        <h5 class="mb-0">
          <i class="fas fa-star"></i> Conseils d'Achat
        </h5>
      </div>
      <div class="card-body">
        <div class="row">
          <div class="col-md-4 mb-3">
            <div class="text-center">
              <i class="fas fa-flask fa-3x text-danger mb-2"></i>
              <h6>Potions</h6>
              <p class="small text-muted">Indispensables pour soigner vos Pokémon en combat</p>
            </div>
          </div>
          <div class="col-md-4 mb-3">
            <div class="text-center">
              <i class="fas fa-circle fa-3x text-primary mb-2"></i>
              <h6>Poké Balls</h6>
              <p class="small text-muted">Capturez de nouveaux Pokémon pour compléter votre Pokédex</p>
            </div>
          </div>
          <div class="col-md-4 mb-3">
            <div class="text-center">
              <i class="fas fa-gem fa-3x text-success mb-2"></i>
              <h6>Pierres d'Évolution</h6>
              <p class="small text-muted">Faites évoluer certains Pokémon spéciaux</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
{% endif %}

<!-- Back Button -->
<div class="mt-4">
  <a href="{% url 'home' %}" class="btn btn-secondary">
    <i class="fas fa-arrow-left"></i> Retour au Dashboard
  </a>
</div>
{% endblock content %}

{% block js %}
{{ block.super }}
<style>
.shop-card {
  transition: transform 0.3s ease, box-shadow 0.3s ease;
  cursor: pointer;
}

.shop-card:hover {
  transform: translateY(-10px);
  box-shadow: 0 10px 30px rgba(0,0,0,0.2) !important;
}

.bg-gradient-primary {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
}
</style>

<script>
$(document).ready(function() {
  // Animation d'entrée
  $('.shop-card').each(function(index) {
    $(this).css('opacity', 0);
    $(this).delay(index * 100).animate({opacity: 1}, 500);
  });
});
</script>
{% endblock js %}